#= require 'session'
#= require 'Putio'
#= require 'Location'
#= require 'router'


@App = App = {
  GIT_SHA: "<%= GIT_SHA %>",
};

App.state = ->
  path:     Location.path
  params:   router.pageFor(Location.path, Location.params)
  loggedIn: !!session('put_io_access_token')

App.getPutioTokenFromHash = ->
  if matches = location.hash.match(/^#access_token=(.*)$/)
    session('put_io_access_token', matches[1])
    window.location = location.toString().substring(0, location.href.indexOf('#'))

App.getPutioTokenFromHash()
App.putio = new Putio(session('put_io_access_token'))

$ ->
  React.render(DOM.App(), document.body)

$(window).on 'unload', (event) ->
  document.body.innerHTML = ''
