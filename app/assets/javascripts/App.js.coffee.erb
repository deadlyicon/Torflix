#= require eventemitter3
#= require_self
#= require_tree ./App


@App = Object.create(EventEmitter.prototype)

@App.GIT_SHA = "<%= GIT_SHA %>"

@App.state = ->
  path:     Location.path
  params:   App.router.pageFor(Location.path, Location.params)
  loggedIn: !!App.session('put_io_access_token')

@App.downloadAndPlayMagnetLink = (magnetLink) ->
  App.putio.transfers.add(magnetLink)
  Location.set Location.for('/autoplay', link: magnetLink)



App.on 'start', ->
  if App.GIT_SHA != ENV.GIT_SHA
    console.error('assets out of date', App.GIT_SHA, 'vs.', ENV.GIT_SHA)
  React.render(DOM.App(), document.body)

$ ->
  App.emit('start')

$(window).on 'unload', (event) ->
  App.emit('stop')
  document.body.innerHTML = ''
