#= require Putio
#= require Location
#= require_self
#= require_tree ./App


@App =

  GIT_SHA: "<%= GIT_SHA %>"

  state: ->
    path:     Location.path
    params:   App.router.pageFor(Location.path, Location.params)
    loggedIn: !!App.session('put_io_access_token')

  downloadAndPlayMagnetLink: (magnetLink) ->
    App.putio.transfers.add(magnetLink)
    Location.set Location.for('/autoplay', link: magnetLink)

$ ->
  console.log('ASSET VERSION: ', App.GIT_SHA)
  console.log('APP   VERSION: ', ENV.GIT_SHA)
  if App.GIT_SHA != ENV.GIT_SHA
    console.error('assets out of date')
  React.render(DOM.App(), document.body)

$(window).on 'unload', (event) ->
  document.body.innerHTML = ''
