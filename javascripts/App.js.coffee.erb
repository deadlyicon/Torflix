#= require eventemitter3
#= require_self
#= require_tree ./App


@App = {}; # Object.create(EventEmitter.prototype)

@App.GIT_SHA = "<%= GIT_SHA %>"
if App.GIT_SHA != ENV.GIT_SHA
  console.error('assets out of date', App.GIT_SHA, 'vs.', ENV.GIT_SHA)

@App.state = ->
  path:     Route.path
  params:   Route.params
  loggedIn: !!App.session('put_io_access_token')

@App.downloadAndPlayMagnetLink = (magnetLink) ->
  App.putio.transfers.add(magnetLink)
  App.location.set App.location.for('/autoplay', link: magnetLink)

App.start = ->
  props = {}
  app = DOM.App(props)
  React.render(app, document.body)
  $(window).on('unload', App.stop)


App.stop = ->
  document.body.innerHTML = ''

$(App.start)

